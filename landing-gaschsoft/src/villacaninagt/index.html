
<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Villa Canina ‚Äì Booking Bar (v8)</title>
<style>
  :root{
    --teal:#18b6b0;
    --blue:#2563eb;
    --bg-grad-from:#e6fffb;
    --bg-grad-to:#ffffff;
    --bg:#ffffff;
    --fg:#0f172a;
    --muted:#6b7280;
    --surface:#ffffff;
    --ring:#7be3df;
    --shadow:0 25px 60px rgba(2, 6, 23, .08);
    --shadow-strong:0 30px 80px rgba(2, 6, 23, .15);
    --danger:#ef4444;
    --header-bg: rgba(255,255,255,.75);
    --ctrl-border: rgba(2,6,23,.20);
    --ctrl-bg: rgba(2,6,23,.04);
    --ctrl-bg-hover: rgba(2,6,23,.08);
  }
  :root[data-theme="dark"]{
    --bg-grad-from:#0b1320;
    --bg-grad-to:#0b1320;
    --bg:#0b1320;
    --fg:#e5e7eb;
    --muted:#94a3b8;
    --surface:#0f1a2b;
    --shadow:0 25px 60px rgba(0,0,0,.45);
    --shadow-strong:0 30px 80px rgba(0,0,0,.6);
    --ring:#2aa39e;
    --header-bg: rgba(11,19,32,.75);
    --ctrl-border: rgba(255,255,255,.25);
    --ctrl-bg: rgba(255,255,255,.06);
    --ctrl-bg-hover: rgba(255,255,255,.12);
  }
  *{box-sizing:border-box}
  body{margin:0;font-family:Inter, ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial;
       background:linear-gradient(180deg, var(--bg-grad-from), var(--bg-grad-to)); color:var(--fg);}
  .container{max-width:1120px;margin:0 auto;padding:0 16px;}
  header{padding:18px 0; position:sticky; top:0; z-index:1000; background:var(--header-bg); border-bottom:1px solid rgba(2,6,23,.08); backdrop-filter:saturate(180%) blur(10px);}
  .brand{display:flex; gap:10px; align-items:center; font-weight:900; font-size:22px; color:var(--teal)}
  .brand img{width:36px; height:36px}
  .row{display:flex; align-items:center; gap:10px}
  .spacer{flex:1}
  .btn{display:inline-flex; align-items:center; justify-content:center; font-weight:800; border:none;
       border-radius:999px; padding:.6rem .95rem; cursor:pointer; gap:8px}
  .btn-outline{background:var(--surface); color:var(--fg); border:2px solid rgba(2,6,23,.08)}
  .btn-primary{background:var(--blue); color:#fff}
  .btn .dot{width:14px;height:14px;border-radius:50%}

  /* iOS-like language switch */
  .lang-switch{position:relative; width:72px; height:32px; display:inline-block; cursor:pointer; user-select:none;
    background:var(--surface); border:2px solid rgba(2,6,23,.12); border-radius:999px; box-shadow:var(--shadow);}
  .lang-switch .knob{position:absolute; top:2px; left:2px; width:26px; height:26px; border-radius:50%;
    transition:left .20s ease; box-shadow:0 6px 12px rgba(0,0,0,.15);}
  .lang-switch[aria-checked='true'] .knob{ left:44px; }
  .lang-label{position:absolute; top:50%; transform:translateY(-50%); font-size:11px; font-weight:800}
  .lang-label.left{ left:10px } .lang-label.right{ right:10px }
  .lang-switch .lang-label{ color:var(--muted) }
  .lang-switch[aria-checked='false'] .lang-label.left{ color:var(--fg) }
  .lang-switch[aria-checked='true'] .lang-label.right{ color:var(--fg) }

  .hero{padding:24px 0 8px; text-align:center}
  .hero h1{font-size:clamp(28px,4.4vw,44px); margin:8px 0 10px; letter-spacing:-.5px}
  .hero p{margin:0; color:var(--muted)}
  .stats{display:grid; grid-template-columns:repeat(4,1fr); gap:16px; max-width:720px; margin:18px auto 0;
         color:var(--fg); font-weight:600; font-size:14px}
  .stat{display:flex; gap:8px; align-items:center}
  .tick{color:var(--teal)}

  /* Hero media */
  .hero-media{position:relative; max-width:720px; margin:18px auto 0; border-radius:20px; overflow:hidden; box-shadow:var(--shadow)}
  .hero-media img{width:100%; height:auto; display:block; background:rgba(2,6,23,.06)}
  .hero-tag{position:absolute; right:12px; top:12px; background:var(--surface); color:var(--fg); border-radius:14px;
            padding:10px 14px; font-weight:900; box-shadow:var(--shadow); border:2px solid rgba(2,6,23,.08)}

  /* Booking Card */
  .card{max-width:860px; margin:22px auto 0; background:var(--surface); border-radius:26px; padding:18px;
        border:4px solid var(--teal); box-shadow:var(--shadow)}
  .grid{display:grid; grid-template-columns:1fr; gap:12px; align-items:stretch}
  @media(min-width:860px){ .grid{ grid-template-columns:1fr 1fr; } }
  .slot{position:relative}
  .chip{display:block; width:100%; text-align:left; border-radius:20px; padding:16px; border:2px solid transparent;
        background:rgba(24,182,176,.08); transition:transform .06s, background .15s, border-color .15s}
  .chip:hover{background:rgba(24,182,176,.15)}
  .chip.active, .chip.filled{ border-color:var(--teal) }
  .chip.error{ border-color:var(--danger) }
  .chip .label{display:flex; gap:8px; align-items:center; margin-bottom:6px; font-size:13px; font-weight:800; color:var(--muted)}
  .chip .value{font-weight:900; font-size:16px; color:var(--fg)}
  .chip:not(.filled) .value{color:var(--muted)}
  .required{color:var(--danger); font-weight:800; margin-left:6px; font-size:12px}

  .cta{margin-top:12px}
  .cta .btn{width:100%; font-size:18px; padding:16px 18px; border-radius:16px; box-shadow:var(--shadow)}

  .help{text-align:center; color:var(--muted); font-size:13px; margin-top:10px}

  .popover{position:absolute; left:0; right:0; top:calc(100% + 10px); z-index:40; border-radius:24px;
           background:var(--surface); border:2px solid rgba(2,6,23,.08); box-shadow:var(--shadow-strong); padding:18px}
  @media(min-width:860px){ .popover{ width:380px; left:auto; } }

  .cal-header{display:flex; justify-content:space-between; align-items:center; margin-bottom:10px}
  .cal-title{font-weight:900; font-size:18px}
  .icon-btn{border:none; background:transparent; border-radius:10px; padding:8px 10px; cursor:pointer}
  .icon-btn:hover{background:rgba(2,6,23,.06)}
  .cal-dow, .cal-days{ display:grid; grid-template-columns:repeat(7, 1fr); gap:8px }
  .dow{ text-align:center; font-size:12px; color:var(--muted); font-weight:800 }
  .day{ height:40px; border-radius:12px; border:1px solid transparent; display:flex; align-items:center; justify-content:center;
        cursor:pointer; font-weight:700 }
  .day:hover{ border-color:rgba(2,6,23,.2) }
  .day.disabled{ opacity:.35; pointer-events:none }
  .day.in-range{ background:rgba(24,182,176,.12) }
  .day.selected{ background:var(--blue); color:#fff }
  .day.start, .day.end{ outline:3px solid var(--ring) }
  .cal-footer{display:flex; gap:10px; margin-top:12px}
  .btn-ghost{background:transparent; border:2px solid transparent; color:var(--teal); font-weight:900; padding:.6rem 1rem; border-radius:999px}
  .btn-ok{ background:var(--blue); color:#fff; border:none; padding:.6rem 1rem; border-radius:999px; font-weight:900; flex:1 }

  .dog-row{display:flex; justify-content:space-between; align-items:center; padding:14px; border-radius:16px;
           background:rgba(2,6,23,.05)}
  .dog-ctrl{display:flex; gap:10px; align-items:center}
  .circle-btn{width:40px; height:40px; border-radius:999px; font-weight:900; border:2px solid var(--ctrl-border); background:var(--ctrl-bg); cursor:pointer; color:var(--fg)}
  .circle-btn:hover{ background:var(--ctrl-bg-hover) }
  .dog-qty{width:40px; text-align:center; font-weight:900}

  .section{max-width:900px; margin:56px auto; text-align:center}
  .section h2{font-size:36px; margin:0 0 10px}
  .section p{color:var(--muted); font-size:18px; margin:0 0 20px}
  .cols{display:grid; grid-template-columns:1fr; gap:20px}
  @media(min-width:860px){ .cols{ grid-template-columns:repeat(4, 1fr) } }
  .card-mini{padding:18px; border-radius:18px; background:var(--surface); box-shadow:var(--shadow)}

  .hidden{display:none !important}
  .nowrap{white-space:nowrap;}
  .hint{font-size:12px;color:var(--danger);margin-top:6px;display:none}
  .hint.show{display:block}

  /* Flags as CSS dots; swap for images if desired */
  .flag-es{
    background: linear-gradient(180deg,#c8102e 0 33%, #ffc400 33% 66%, #c8102e 66% 100%);
    border:1px solid rgba(0,0,0,.15);
  }
  .flag-us{
    background: repeating-linear-gradient(180deg,#b22234 0 7px,#fff 7px 14px);
    position:relative;
  }
  .flag-us::before{
    content:""; position:absolute; left:0; top:0; width:55%; height:55%;
    background:#3c3b6e; border-top-left-radius:50%; border-bottom-right-radius:6px;
  }
  .flag-us::after{
    content:""; position:absolute; left:8%; top:10%; width:40%; height:40%;
    background: radial-gradient(#fff 1px, transparent 1.5px) 0 0/5px 5px; opacity:.9;
  }
</style>
</head>
<body>
<header>
  <div class="container row">
    <div class="brand"><img src="LogoVillaCanina.png" alt="Villa Canina"><span>Villa Canina</span></div>
    <div class="spacer"></div>
    <div id="langSwitch" class="lang-switch" role="switch" aria-checked="false" tabindex="0" title="Idioma">
      <span class="lang-label left">ES</span>
      <span class="lang-label right">EN</span>
      <span id="langKnob" class="knob flag-es" aria-hidden="true"></span>
    </div>
    <button id="themeBtn" class="btn btn-outline" title="Tema"><span id="themeIcon">üñ•Ô∏è</span></button>
    <a class="btn btn-primary" href="#booking"><span data-i18n="book_now">Reservar</span></a>
  </div>
</header>

<main>
  <section class="hero">
    <div class="container">
      <h1 data-i18n="hero_title">Cuido local y confiable de perros</h1>
      <p data-i18n="hero_sub">Reserva cuidadores 5 estrellas</p>
      <div class="stats">
        <div class="stat"><span class="tick">‚úì</span> <span data-i18n="stat1">12M+ servicios</span></div>
        <div class="stat"><span class="tick">‚úì</span> <span data-i18n="stat2">99% 5 estrellas</span></div>
        <div class="stat"><span class="tick">‚úì</span> <span data-i18n="stat3">Verificados</span></div>
        <div class="stat"><span class="tick">‚úì</span> <span data-i18n="stat4">500k cuidadores</span></div>
      </div>

      <div class="hero-media">
        <img src="ImagenHeroSection.png" alt="Foto de cuidadores y perros">
      </div>
    </div>
  </section>

  <section id="booking">
    <div class="container card">
      <form id="vcForm" novalidate>
        <div class="grid">
          <div class="slot">
            <button id="dateChip" type="button" class="chip" aria-haspopup="dialog" aria-expanded="false">
              <div class="label">üìÖ <span data-i18n="choose_dates">Seleccionar fechas</span> <span class="required" data-i18n="required">*</span></div>
              <div id="dateValue" class="value" aria-live="polite" data-i18n="pick_dates">Selecciona tus fechas</div>
            </button>
            <div id="datePopover" class="popover hidden" role="dialog" aria-modal="false">
              <div class="cal-header">
                <button id="prevMonth" type="button" class="icon-btn">‚Üê</button>
                <div id="monthLabel" class="cal-title"></div>
                <button id="nextMonth" type="button" class="icon-btn">‚Üí</button>
              </div>
              <div class="cal-dow" id="dow"></div>
              <div class="cal-days" id="days"></div>
              <div class="cal-footer">
                <button id="clearBtn" type="button" class="btn-ghost" data-i18n="clear">Limpiar fechas</button>
                <button id="okBtn" type="button" class="btn-ok" data-i18n="ok">OK</button>
              </div>
              <div id="dateError" class="hint" style="margin-top:8px;"></div>
            </div>
          </div>

          <div class="slot">
            <button id="dogChip" type="button" class="chip" aria-haspopup="dialog" aria-expanded="false">
              <div class="label">üêï <span data-i18n="add_dogs">A√±adir perros</span> <span class="required" data-i18n="required">*</span></div>
              <div id="dogValue" class="value" data-i18n="pick_qty">Selecciona cantidad</div>
            </button>
            <div id="dogPopover" class="popover hidden" role="dialog">
              <h3 style="margin:0 0 12px; font-size:18px" data-i18n="add_pets">A√±adir mascotas</h3>
              <div class="dog-row">
                <div style="display:flex; align-items:center; gap:10px; font-weight:800">üêï <span data-i18n="dogs">Perros</span></div>
                <div class="dog-ctrl">
                  <button id="minusDog" type="button" class="circle-btn">‚àí</button>
                  <div id="dogQty" class="dog-qty">0</div>
                  <button id="plusDog" type="button" class="circle-btn">Ôºã</button>
                </div>
              </div>
              <div id="dogError" class="hint" style="margin-left:4px;"></div>
            </div>
          </div>
        </div>

        <div class="cta">
          <button class="btn btn-primary" type="submit"><span data-i18n="continue">Continuar ‚Üí</span></button>
        </div>
        <p class="help" data-i18n="json_help">Los datos se enviar√°n al backend en formato JSON.</p>
      </form>
    </div>
  </section>

  <section class="section">
    <div class="container">
      <h2 data-i18n="how_title">C√≥mo funciona Villa Canina</h2>
      <p data-i18n="how_sub">Encuentra y reserva cuidadores de confianza cerca de ti</p>
      <div class="cols">
        <div class="card-mini"><div style="font-size:48px">üîç</div><h3 data-i18n="step1">1. Busca</h3><p data-i18n="step1_p">Encuentra cuidadores verificados en tu √°rea</p></div>
        <div class="card-mini"><div style="font-size:48px">üìÖ</div><h3 data-i18n="step2">2. Reserva</h3><p data-i18n="step2_p">Selecciona fechas y confirma tu reserva</p></div>
        <div class="card-mini"><div style="font-size:48px">üòä</div><h3 data-i18n="step3">3. Rel√°jate</h3><p data-i18n="step3_p">Tu perro estar√° en buenas manos</p></div>
        <div class="card-mini"><div style="font-size:48px">‚≠ê</div><h3 data-i18n="step4">4. Valorar y comentar</h3><p data-i18n="step4_p">Comparte tu experiencia y ayuda a otros a encontrar a su cuidador ideal.</p></div>
      </div>
      <p style="margin-top:14px; color:var(--muted)" data-i18n="follow_note">S√≠guenos en nuestras redes.</p>
    </div>
  </section>
</main>

<script>
  const I18N = {
    es: {book_now:"Reservar",hero_title:"¬°Diversi√≥n, amor y cuidado confiable para tu mascota!",hero_sub:"Reserva en nuestro hotel 5 estrellas",
      stat1:"Atendimos a m√°s de 5,000 perritos",stat2:"99% 5 estrellas en Google",stat3:"Verificados",stat4:"Personal Profesional",
      choose_dates:"Seleccionar fechas",required:"*Requerido",pick_dates:"Selecciona tus fechas",
      clear:"Limpiar fechas",ok:"OK",
      add_dogs:"A√±adir perros",pick_qty:"Selecciona cantidad",add_pets:"A√±adir mascotas",dogs:"Perros",
      continue:"Continuar ‚Üí",json_help:"Los datos se enviar√°n al backend en formato JSON.",
      how_title:"C√≥mo funciona Villa Canina",how_sub:"Encuentra y reserva cuidadores de confianza cerca de ti",
      step1:"1. Busca",step1_p:"Encuentra cuidadores verificados en tu √°rea",
      step2:"2. Reserva",step2_p:"Selecciona fechas y confirma tu reserva",
      step3:"3. Rel√°jate",step3_p:"Tu perro estar√° en buenas manos",
      step4:"4. Valorar y comentar", step4_p:"Comparte tu experiencia y ayuda a otros a encontrar a su cuidador ideal.",
      follow_note:"S√≠guenos en nuestras redes.",
      hero_tag:"Amaremos y cuidaremos a tu perro",
      date_error_range:(n)=>`Rango m√°ximo: ${n} d√≠as.`,date_error_pick:"Selecciona inicio y fin.",
      date_error_need:"Selecciona un rango v√°lido.",dogs_required:"Debes a√±adir al menos 1 perro."},
    en: {book_now:"Book",hero_title:"Fun, love, and trusted care for your pet!",hero_sub:"Book our 5-star pet hotel",
      stat1:"We‚Äôve cared for 5,000+ dogs",stat2:"99% 5-star rating on Google",stat3:"Verified",stat4:"Professional staff",
      choose_dates:"Select dates",required:"*Required",pick_dates:"Pick your dates",
      clear:"Clear dates",ok:"OK",
      add_dogs:"Add dogs",pick_qty:"Select quantity",add_pets:"Add pets",dogs:"Dogs",
      continue:"Continue ‚Üí",json_help:"Data will be sent to the backend as JSON.",
      how_title:"How Villa Canina works",how_sub:"Find and book trusted caregivers near you",
      step1:"1. Search",step1_p:"Find verified caregivers in your area",
      step2:"2. Book",step2_p:"Pick dates and confirm your booking",
      step3:"3. Relax",step3_p:"Your dog will be in good hands",
      step4:"4. Rate and review", step4_p:"Share your experience to help others find their perfect sitter.",
      follow_note:"Follow us on social media.",
      hero_tag:"We‚Äôll love and care for your dog",
      date_error_range:(n)=>`Maximum range is ${n} days.`,date_error_pick:"Select start and end dates.",
      date_error_need:"Please choose a valid range.",dogs_required:"Please add at least 1 dog."}
  };

  // Language switch
  (function(){
    const KEY='vc_lang';
    const sw=document.getElementById('langSwitch');
    const knob=document.getElementById('langKnob');
    let lang=localStorage.getItem(KEY) || 'es';
    function render(){
      document.documentElement.lang = lang;
      const dict=I18N[lang];
      document.querySelectorAll('[data-i18n]').forEach(el=>{
        const key=el.getAttribute('data-i18n'); const v=dict[key];
        if(typeof v === 'string') el.textContent = v;
      });
      sw.setAttribute('aria-checked', String(lang==='en'));
      knob.className = 'knob ' + (lang==='es'?'flag-es':'flag-us');
      window.__i18n__ = dict; document.dispatchEvent(new Event('languagechange'));
    }
    function toggle(){ lang=(lang==='es')?'en':'es'; localStorage.setItem(KEY,lang); render(); }
    sw.addEventListener('click', toggle);
    sw.addEventListener('keydown', (e)=>{ if(e.key===' '||e.key==='Enter'){ e.preventDefault(); toggle(); }});
    render();
  })();

  // Theme button (icon only)
  (function(){
    const KEY='vc_theme_mode'; const btn=document.getElementById('themeBtn');
    const icon=document.getElementById('themeIcon'); const media = window.matchMedia('(prefers-color-scheme: dark)');
    let mode = localStorage.getItem(KEY) || 'system';
    function currentTheme(){ return mode==='system' ? (media.matches ? 'dark' : 'light') : mode; }
    function renderTheme(){ const theme=currentTheme(); document.documentElement.setAttribute('data-theme', theme);
      if(mode==='system'){ icon.textContent='üñ•Ô∏è'; } else if(mode==='light'){ icon.textContent='‚òÄÔ∏è'; } else { icon.textContent='üåô'; } }
    btn.addEventListener('click', ()=>{ mode = mode==='system' ? 'light' : (mode==='light' ? 'dark' : 'system'); localStorage.setItem(KEY,mode); renderTheme(); });
    media.addEventListener('change', ()=>{ if(mode==='system') renderTheme(); });
    document.addEventListener('languagechange', renderTheme);
    renderTheme();
  })();

  function attachPopover(trigger, popover){
    function toggle(){ const open = !popover.classList.contains('hidden'); if(open) close(); else openPop(); }
    function openPop(){ popover.classList.remove('hidden'); trigger.setAttribute('aria-expanded','true'); document.addEventListener('click', onDoc, true); }
    function close(){ popover.classList.add('hidden'); trigger.setAttribute('aria-expanded','false'); document.removeEventListener('click', onDoc, true); }
    function onDoc(e){ if(!popover.contains(e.target) && !trigger.contains(e.target)) close(); }
    trigger.addEventListener('click', toggle);
    return { open: openPop, close };
  }

  // Calendar
  (function(){
    const MS_DAY=86400000, MAX_RANGE=60;
    const today=new Date(); today.setHours(0,0,0,0);
    let start=null, end=null; let view=new Date(today.getFullYear(), today.getMonth(), 1);
    const chip=document.getElementById('dateChip'); const value=document.getElementById('dateValue');
    const pop=document.getElementById('datePopover'); const daysEl=document.getElementById('days'); const dowEl=document.getElementById('dow');
    const label=document.getElementById('monthLabel'); const err=document.getElementById('dateError');
    const pp=attachPopover(chip, pop);

    function dowNames(){ return (document.documentElement.lang==='es' ? 'Lu Ma Mi Ju Vi S√° Do' : 'Mo Tu We Th Fr Sa Su').split(' '); }
    function paintDow(){ dowEl.innerHTML=''; dowNames().forEach(d=>{ const el=document.createElement('div'); el.className='dow'; el.textContent=d; dowEl.appendChild(el); }); }
    function fmt(d){ const lang=document.documentElement.lang || 'es'; return d.toLocaleDateString(lang==='es'?'es-GT':'en-US',{month:'long', day:'2-digit'}); }
    function nights(a,b){ return Math.ceil((b-a)/MS_DAY); }
    function same(a,b){ return a && b && a.getTime()===b.getTime(); }
    function between(x,a,b){ return a && b && x>a && x<b; }

    function render(){
      const lang=document.documentElement.lang || 'es';
      label.textContent=view.toLocaleDateString(lang==='es'?'es-GT':'en-US',{month:'long', year:'numeric'});
      daysEl.innerHTML='';
      const first=new Date(view.getFullYear(), view.getMonth(), 1);
      const startDow=(first.getDay()+6)%7; const count=new Date(view.getFullYear(), view.getMonth()+1, 0).getDate();
      for(let i=0;i<startDow;i++){ daysEl.appendChild(document.createElement('div')); }
      for(let d=1; d<=count; d++){
        const date=new Date(view.getFullYear(), view.getMonth(), d);
        const el=document.createElement('div'); el.className='day'; el.textContent=String(d);
        if(date < today) el.classList.add('disabled');
        if(same(date,start)) el.classList.add('selected','start');
        if(same(date,end)) el.classList.add('selected','end');
        if(between(date,start,end)) el.classList.add('in-range');
        el.addEventListener('click',()=>onPick(date));
        daysEl.appendChild(el);
      }
    }

    function onPick(date){
      err.classList.remove('show'); err.textContent='';
      if(!start || (start && end)){ start=date; end=null; }
      else{
        if(date < start){ end=start; start=date; } else { end=date; }
        if(nights(start,end) > MAX_RANGE){ end=null; err.textContent=(window.__i18n__||I18N.es).date_error_range(MAX_RANGE); err.classList.add('show'); }
      }
      updateValue(); render();
    }

    function updateValue(){
      if(start && end) value.textContent=fmt(start)+'  ‚Äì  '+fmt(end);
      else if(start) value.textContent=fmt(start)+'  ‚Äì  ‚Ä¶';
      else value.textContent=(window.__i18n__||I18N.es).pick_dates;
      chip.classList.toggle('filled', !!(start && end));
    }

    document.getElementById('prevMonth').addEventListener('click', ()=>{
      const prev=new Date(view.getFullYear(), view.getMonth()-1, 1);
      const min=new Date(today.getFullYear(), today.getMonth(), 1);
      if(prev >= min){ view=prev; render(); }
    });
    document.getElementById('nextMonth').addEventListener('click', ()=>{ view=new Date(view.getFullYear(), view.getMonth()+1, 1); render(); });
    document.getElementById('clearBtn').addEventListener('click', ()=>{ start=end=null; updateValue(); render(); });
    document.getElementById('okBtn').addEventListener('click', ()=>{
      if(!start || !end){ err.textContent=(window.__i18n__||I18N.es).date_error_pick; err.classList.add('show'); return; }
      pp.close();
    });

    document.addEventListener('languagechange', ()=>{ paintDow(); render(); updateValue(); });
    paintDow(); updateValue(); render();

    window.__booking_dates__ = () => ({ start, end });
  })();

  // Dogs
  (function(){
    const chip=document.getElementById('dogChip'); const pop=document.getElementById('dogPopover'); const value=document.getElementById('dogValue');
    const qtyEl=document.getElementById('dogQty'); const minus=document.getElementById('minusDog'); const plus=document.getElementById('plusDog'); const error=document.getElementById('dogError');
    const pp=attachPopover(chip, pop); let qty=0;

    function update(){
      qtyEl.textContent=String(qty);
      const dict = (window.__i18n__||I18N.es);
      value.textContent = qty>0 ? (document.documentElement.lang==='es' ? `${qty} ${qty===1?'Perro':'Perros'}` : `${qty} ${qty===1?'Dog':'Dogs'}`) : dict.pick_qty;
      chip.classList.toggle('filled', qty>0);
      chip.classList.toggle('error', qty===0 && error.classList.contains('show'));
    }
    function showErr(msg){ error.textContent=msg; error.classList.add('show'); chip.classList.add('error'); }
    function hideErr(){ error.classList.remove('show'); chip.classList.remove('error'); }

    minus.addEventListener('click', ()=>{ qty=Math.max(0, qty-1); if(qty>0) hideErr(); update(); });
    plus.addEventListener('click',  ()=>{ qty=qty+1; hideErr(); update(); });

    document.addEventListener('languagechange', ()=>{ if(error.classList.contains('show')) showErr((window.__i18n__||I18N.es).dogs_required); update(); });

    update();
    window.__dog_qty__ = () => qty;
    window.__open_dog__ = () => pp.open();
  })();

  // Submit: validate
  (function(){
    const form=document.getElementById('vcForm');
    form.addEventListener('submit', (e)=>{
      e.preventDefault();
      const dict=(window.__i18n__||I18N.es);
      const { start, end } = window.__booking_dates__();
      const qty = window.__dog_qty__();
      let ok=true;
      if(!start || !end){
        document.getElementById('datePopover').classList.remove('hidden');
        document.getElementById('dateChip').classList.add('error');
        const err=document.getElementById('dateError'); err.textContent = dict.date_error_need; err.classList.add('show'); ok=false;
      }
      if(qty < 1){
        window.__open_dog__();
        const err=document.getElementById('dogError'); err.textContent = dict.dogs_required; err.classList.add('show');
        document.getElementById('dogChip').classList.add('error'); ok=false;
      }
      if(!ok) return;
      const payload={ dateStart: start.toISOString().slice(0,10), dateEnd: end.toISOString().slice(0,10), dogCount: qty };
      alert('Payload listo/ready for backend:\\n'+JSON.stringify(payload,null,2));
      sessionStorage.setItem('vc_booking', JSON.stringify(payload));
    });
  })();
</script>
</body>
</html>
